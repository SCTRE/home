<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <title>ğŸ’–</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      /* ç¦æ­¢ç§»åŠ¨ç«¯é«˜äº®ç‚¹å‡»é¢œè‰² */
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: "Microsoft YaHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      transition: background 1s;
      background: radial-gradient(circle at 50% 45%, #fef6f9 0%, #cbeeff 100%);
      /* é˜²æ­¢ç§»åŠ¨ç«¯å¼¹æ€§æ»šåŠ¨ */
      overscroll-behavior: none;
    }
    
    body.dark {
      background: radial-gradient(circle at 50% 45%, #121212 0%, #000000 100%);
      color: #eee;
    }

    /* é›ªèŠ±æ ·å¼ */
    .snow {
      position: fixed;
      top: -10px;
      color: white;
      user-select: none;
      pointer-events: none;
      animation: snowfall linear forwards;
      z-index: 1000001;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
      will-change: transform, opacity; /* æ€§èƒ½ä¼˜åŒ–ï¼šå¯ç”¨GPUåŠ é€Ÿ */
    }
    @keyframes snowfall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }

    /* å¼¹çª—æ ·å¼ */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-backdrop.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background-color: #ffffff;
      padding: 0 0 15px;
      border-radius: 12px;
      text-align: center;
      width: 90%;
      max-width: 380px;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }
    body.dark .modal {
      background-color: #2a2a2a;
    }
    body.dark .title {
      color: #f0f0f0;
    }
    body.dark .content {
      color: #ccc;
    }
    .modal-backdrop.active .modal {
      transform: scale(1);
    }
    .titlebar {
      width: 100%;
      margin: 0 0 10px;
      padding: 8px 0;
      background-color: #fff0f0;
      border-radius: 12px 12px 0 0;
      text-align: center;
    }
    .icon {
      font-size: 26px;
      display: inline-block;
      margin-bottom: 6px;
      animation: bounce 1.5s infinite;
    }
    .title {
      font-size: 16px;
      font-weight: 800;
      color: #333;
    }
    .content {
      font-size: 15px;
      color: #666;
      margin: 0 25px 18px;
      line-height: 1.5;
    }
    .actions {
      display: flex;
      justify-content: center;
      margin: 0 25px 5px;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* å³ä¸‹è§’æŒ‰é’® */
    .controls {
      position: fixed;
      right: 15px;
      bottom: 50px;
      display: none;
      gap: 8px;
      align-items: center;
      z-index: 9999;
    }
    .controls .btn {
      padding: 8px 12px;
      font-size: 13px;
    }
    .btn {
      padding: 10px 14px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px); /* Safariå…¼å®¹ */
      color: #222;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0,0,0,0.25);
      font-size: clamp(14px, 2.5vmin, 18px);
      transition: all 0.3s;
    }
    body.dark .btn {
      background: rgba(50, 50, 50, 0.4);
      color: #eee;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    body.dark .btn:hover {
      box-shadow: 0 8px 25px rgba(0,0,0,0.7);
    }
    .btn.primary {
      padding: 7px 12px;
      font-size: 14px;
      background-color: #ff6b6b;
      color: white;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
    }
    .btn.primary:hover {
      background-color: #ff5252;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
    }
    .btn.primary:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
    }
    body.dark .btn.primary {
      background-color: #ff6b6b;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5);
    }
    body.dark .btn.primary:hover {
      background-color: #ff5252;
      box-shadow: 0 6px 16px rgba(255, 107, 107, 0.6);
    }

    /* ä¾¿ç­¾å¢™æ ·å¼ */
    #board {
      position: relative;
      width: 100vw;
      height: 100vh; /* å…¼å®¹æ€§å›é€€ï¼šæ—§ç‰ˆæµè§ˆå™¨ */
      height: 100dvh; /* ç°ä»£æµè§ˆå™¨ */
      overflow: hidden;
    }
    body.is-mobile #board {
      height: 100vh;
      height: 100dvh; /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    }
    .card {
      position: absolute;
      width: 220px;
      border-radius: 12px;
      box-shadow: 0 16px 35px rgba(0, 0, 0, 0.2);
      background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.08);
      overflow: hidden;
      opacity: 0;
      transform-origin: center;
      transition: transform 0.35s ease, opacity 0.35s ease, left 0.35s ease, top 0.35s ease, width 0.35s ease, height 0.35s ease, border-radius 0.35s ease;
      /* ä¼˜åŒ–ï¼šGPUåŠ é€Ÿ */
      will-change: transform, left, top;
    }
    .card.dragging {
      transition: none; /* æ‹–æ‹½æ—¶ç¦ç”¨è¿‡æ¸¡ï¼Œç¡®ä¿è·Ÿæ‰‹ */
      box-shadow: 0 22px 45px rgba(0, 0, 0, 0.35);
      z-index: 999999;
    }
    .card.maximized {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh; /* å…¼å®¹æ€§å›é€€ */
      height: 100dvh;
      border-radius: 0;
      box-shadow: 0 28px 60px rgba(0, 0, 0, 0.4);
      z-index: 1000000;
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.7);
      cursor: grab;
      user-select: none;
      /* å…³é”®ä¼˜åŒ–ï¼šé˜²æ­¢æ‹–æ‹½æ—¶è§¦å‘é¡µé¢æ»šåŠ¨ */
      touch-action: none; 
    }
    .card-header.dragging {
      cursor: grabbing;
    }
    .window-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .window-controls .control {
      position: relative;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #ccc;
      cursor: pointer;
      outline: none;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .window-controls .control.close { background: #ff5f57; border-color: #e0443e; }
    .window-controls .control.minimize { background: #febb2e; border-color: #dea123; }
    .window-controls .control.maximize { background: #28c840; border-color: #1aab2c; }
    
    .window-controls .control::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .card-header:hover .window-controls .control::after { opacity: 0.8; }
    
    /* ç§»åŠ¨ç«¯å§‹ç»ˆæ˜¾ç¤ºå…³é—­å›¾æ ‡ï¼Œæå‡å¯ç”¨æ€§ */
    @media (pointer: coarse) {
        .window-controls .control::after { opacity: 0.8; }
    }

    .window-controls .control.close::after {
      content: 'Ã—';
      width: auto; height: auto;
      background: none;
      font-size: 10px;
      line-height: 1;
      font-weight: 700;
      color: rgba(0, 0, 0, 0.7);
    }
    .window-controls .control.minimize::after {
      width: 6px; height: 2px;
      background: rgba(0, 0, 0, 0.6);
    }
    .window-controls .control.maximize::after {
      width: 6px; height: 6px;
      background: linear-gradient(45deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.6) 45%, transparent 45%, transparent 55%, rgba(0,0,0,0.6) 55%, rgba(0,0,0,0.6) 100%);
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.55);
      padding-left: 10px;
      flex: 1;
    }
    .card-body {
      padding: 16px;
      font-size: 16px;
      line-height: 1.4;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.72);
      word-break: break-word;
      overflow-wrap: anywhere;
      white-space: normal;
    }
    .card.maximized {
      display: flex;
      flex-direction: column;
    }
    .card.maximized .card-title { display: none; }
    .card.maximized .card-body {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      text-align: center;
      padding: 32px; /* å…¼å®¹æ€§å›é€€ */
      padding: clamp(32px, min(10vw, 10vh), 128px);
      padding-top: clamp(72px, min(14vw, 14vh), 192px);
      font-size: clamp(48px, min(18vw, 18vh), 200px);
      line-height: 1.05;
    }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      .card {
        width: 180px;
        border-radius: 10px;
      }
      .card-body {
        padding: 14px;
        font-size: 14px;
      }
      .card-title {
        font-size: 12px;
      }
    }

    /* åº•éƒ¨æ ‡è¯† */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0px 0px;
      text-align: center;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-top: 1px solid rgba(0, 0, 0, 0.2);
      z-index: 1000;
      font-size: 12px;
      color: rgba(0, 0, 0, 0.9);
      display: none;
    }
    body.dark .footer {
      background: rgba(0, 0, 0, 0.2);
      color: rgba(255, 255, 255, 0.9);
      border-top: 1px solid rgba(255, 255, 255, 0.3);
    }
    .footer-line {
      margin: 3px 0;
      line-height: 1.3;
    }
    .footer a {
      color: inherit;
      text-decoration: none;
      transition: opacity 0.3s;
      font-weight: 600;
    }
    .footer a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
    .footer svg {
      vertical-align: text-bottom;
      margin-right: 4px;
    }
  </style>
  <!-- å¼•å…¥ç»Ÿè®¡è„šæœ¬ (ä¿ç•™åŸåŠŸèƒ½) -->
  <script>
    var _czc = _czc || [];
    (function () {
      var um = document.createElement("script");
      um.src = "https://v1.cnzz.com/z.js?id=1281334347&async=1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(um, s);
    })();
  </script>
</head>
<body>
  <div id="app">
    <!-- å¼¹çª— -->
    <div class="modal-backdrop" id="start-backdrop">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="titlebar">
          <span class="icon">â¤ï¸</span>
          <span class="title" id="modal-title">ç¤¼ç‰©</span>
        </div>
        <div class="content">æ‚¨æœ‰ä¸€ä»½ç¤¼ç‰©ï¼Œç¡®å®šè¦æ‰“å¼€å—ï¼Ÿ</div>
        <div class="actions">
          <button class="btn primary" id="confirm-btn" autofocus>ç¡®å®š</button>
        </div>
      </div>
    </div>
    
    <div id="board"></div>
    
    <div class="controls">
      <button class="btn" id="themeBtn">åˆ‡æ¢ä¸»é¢˜</button>
      <button class="btn" id="replay-main">é‡æ’­ / åˆ‡æ¢èƒŒæ™¯</button>
    </div>
  </div>

  <!-- åº•éƒ¨ -->
  <footer class="footer" id="page-footer">
    <div class="footer-line">
      Designed & Maintained by <a href="https://www.douyin.com/user/MS4wLjABAAAA_ml9jDiT3gM8tu-K2JI-aUTF_xXL-F1U3CZl8s-cacs?showTab=post" target="_blank" rel="noopener noreferrer">å•Šå•µå‘²å˜š</a>
    </div>
    <div class="footer-line">
      <a href="https://github.com/SCTRE" target="_blank" rel="noopener noreferrer">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        GitHub
      </a>
    </div>
  </footer>

  <audio id="bgMusic" preload="auto">
    <source src="https://lf26-music-east.douyinstatic.com/obj/ies-music-hj/7495920705440140091.mp3" type="audio/mpeg">
  </audio>

  <script>
    // --- é›ªèŠ±ç³»ç»Ÿ ---
    let snowRunning = false;
    let snowFrame;
    let lastSnowTime = 0;
    
    function createSnow() {
      const snow = document.createElement('div');
      snow.className = 'snow';
      snow.textContent = 'â„';
      snow.style.left = Math.random() * 100 + 'vw';
      snow.style.fontSize = (Math.random() * 12 + 8) + 'px';
      snow.style.opacity = (Math.random() * 0.8 + 0.2);
      const duration = (Math.random() * 5 + 6);
      snow.style.animationDuration = duration + 's';
      document.body.appendChild(snow);
      setTimeout(() => snow.remove(), duration * 1000);
    }
    
    function loopSnow(timestamp) {
      if (!lastSnowTime) lastSnowTime = timestamp;
      const delta = timestamp - lastSnowTime;
      if (delta > 400) {
        if (snowRunning) createSnow();
        lastSnowTime = timestamp;
      }
      snowFrame = requestAnimationFrame(loopSnow);
    }
    
    function startSnow() {
      if (snowRunning) return;
      snowRunning = true;
      lastSnowTime = 0;
      loopSnow();
    }
    
    function stopSnow() {
      snowRunning = false;
      cancelAnimationFrame(snowFrame);
      document.querySelectorAll('.snow').forEach(s => s.remove());
    }

    // --- ä¾¿ç­¾å¢™æ ¸å¿ƒé€»è¾‘ ---
    const board = document.getElementById('board');
    const messages = [
      'ä¿æŒå¥½å¿ƒæƒ…', 'å¤šå–æ°´å“¦', 'ä»Šå¤©è¾›è‹¦å•¦', 'æ—©ç‚¹ä¼‘æ¯',
      'è®°å¾—åƒæ°´æœ', 'åŠ æ²¹ï¼Œä½ å¯ä»¥çš„', 'ç¥ä½ é¡ºåˆ©', 'ä¿æŒå¾®ç¬‘å‘€',
      'æ„¿æ‰€æœ‰çƒ¦æ¼éƒ½æ¶ˆå¤±', 'æœŸå¾…ä¸‹ä¸€æ¬¡è§é¢', 'æ¢¦æƒ³æ€»ä¼šå®ç°',
      'å¤©æ°”å†·äº†ï¼Œå¤šç©¿è¡£æœ', 'è®°å¾—ç»™è‡ªå·±æ”¾æ¾', 'æ¯å¤©éƒ½è¦å…ƒæ°”æ»¡æ»¡',
      'ä»Šå¤©ä¹Ÿè¦å¥½å¥½çˆ±è‡ªå·±', 'é€‚å½“ä¼‘æ¯ä¸€ä¸‹'
    ];

    const colors = [
      '#ffe0e3', '#c7f0ff', '#ffd8a8', '#d9f2d9',
      '#e5d7ff', '#f9f7d9', '#d2f0f8', '#ffd4f5'
    ];

    const cardStates = new WeakMap();
    const MAXIMIZED_LAYER = 1000000;
    let activeMaximizedCard = null;
    let isMobile = window.matchMedia('(pointer: coarse)').matches || window.innerWidth <= 768;
    
    // æ ¹æ®è®¾å¤‡è°ƒæ•´å‚æ•°
    let maxCards = isMobile ? 80 : 180; // ç§»åŠ¨ç«¯å‡å°‘æ•°é‡ä»¥ä¼˜åŒ–æ€§èƒ½
    const initialCardCount = isMobile ? 18 : 30;
    let spawnInterval = isMobile ? 700 : 400;
    let zIndexCursor = 200;
    let spawnTimer = null;

    document.body.classList.toggle('is-mobile', isMobile);

    function randomFrom(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function clamp(value, min, max) {
      return Math.min(Math.max(value, min), max);
    }

    function applyTransform(card, state) {
      // å…¼å®¹æ€§ä¿®å¤ï¼šæ›¿æ¢ ?? è¿ç®—ç¬¦ï¼Œé˜²æ­¢ä½ç‰ˆæœ¬æµè§ˆå™¨æŠ¥é”™ç™½å±
      const scale = (state.scale !== undefined && state.scale !== null) ? state.scale : 1;
      const angle = (state.angle !== undefined && state.angle !== null) ? state.angle : 0;
      card.style.transform = `scale(${scale}) rotate(${angle}deg)`;
    }

    function bringToFront(card) {
      if (card === activeMaximizedCard) {
        card.style.zIndex = MAXIMIZED_LAYER;
        return;
      }
      zIndexCursor += 1;
      if (activeMaximizedCard && zIndexCursor >= MAXIMIZED_LAYER) {
        zIndexCursor = MAXIMIZED_LAYER - 1;
      }
      card.style.zIndex = zIndexCursor;
    }

    function updateBodyMaximizedState() {
      document.body.classList.toggle('has-maximized-card', Boolean(activeMaximizedCard));
    }

    function scheduleNextSpawn() {
      clearTimeout(spawnTimer);
      spawnTimer = setTimeout(() => {
        if (!document.hidden && !activeMaximizedCard) {
          createCard();
        }
        scheduleNextSpawn();
      }, spawnInterval);
    }

    function syncMobileMode() {
      const nextIsMobile = window.matchMedia('(pointer: coarse)').matches || window.innerWidth <= 768;
      if (nextIsMobile === isMobile) return;

      isMobile = nextIsMobile;
      maxCards = isMobile ? 80 : 180;
      spawnInterval = isMobile ? 700 : 400;
      document.body.classList.toggle('is-mobile', isMobile);
      scheduleNextSpawn();
    }

    // --- äº‹ä»¶å¤„ç†ä¼˜åŒ– (Pointer Events) ---
    function handleBoardClick(event) {
      const control = event.target.closest('.control');
      if (!control) return;

      const card = control.closest('.card');
      if (!card || !board.contains(card)) return;

      event.preventDefault(); // é˜²æ­¢ç‚¹å‡»ç©¿é€

      if (control.classList.contains('close')) {
        closeCard(card);
      } else if (control.classList.contains('minimize')) {
        minimizeCard(card);
      } else if (control.classList.contains('maximize')) {
        toggleMaximize(card);
      }
    }

    function handleBoardPointerDown(event) {
      // å¿½ç•¥å³é”®
      if (event.button === 2) return;

      const card = event.target.closest('.card');
      if (!card || !board.contains(card)) return;

      const control = event.target.closest('.control');
      const header = event.target.closest('.card-header');
      
      // åªæœ‰ç‚¹å‡»Headerä¸”ä¸æ˜¯æ§åˆ¶æŒ‰é’®æ—¶æ‰è§¦å‘æ‹–æ‹½
      if (header && !control) {
        startDrag(event, card);
        return;
      }
      
      bringToFront(card);
    }

    function handleBoardDoubleClick(event) {
      const header = event.target.closest('.card-header');
      if (!header || event.target.closest('.control')) return;
      const card = header.closest('.card');
      if (!card || !board.contains(card)) return;
      toggleMaximize(card);
    }

    // ä½¿ç”¨ pointerdown æ›¿ä»£ mousedown/touchstart ç»Ÿä¸€å¤„ç†
    board.addEventListener('click', handleBoardClick);
    board.addEventListener('pointerdown', handleBoardPointerDown);
    board.addEventListener('dblclick', handleBoardDoubleClick);

    function closeCard(card) {
      const state = cardStates.get(card);
      if (!state || state.closing) return;
      if (card === activeMaximizedCard) {
        activeMaximizedCard = null;
        updateBodyMaximizedState();
      }
      state.closing = true;
      state.scale = 0.1;
      card.style.opacity = '0';
      applyTransform(card, state);

      const handleTransitionEnd = (event) => {
        if (event.propertyName === 'opacity') {
          card.removeEventListener('transitionend', handleTransitionEnd);
          card.remove();
        }
      };
      card.addEventListener('transitionend', handleTransitionEnd);
    }

    function minimizeCard(card) {
      const state = cardStates.get(card);
      if (state.isMinimized) {
        state.scale = 1;
        state.isMinimized = false;
      } else {
        state.scale = 0.7;
        state.isMinimized = true;
      }
      applyTransform(card, state);
    }

    function toggleMaximize(card) {
      if (card.classList.contains('maximized')) {
        card.classList.remove('maximized');
        const state = cardStates.get(card);
        if (state) {
          card.style.left = state.x + 'vw';
          card.style.top = state.y + 'vh';
          applyTransform(card, state);
        }
        activeMaximizedCard = null;
      } else {
        card.classList.add('maximized');
        card.style.left = '0';
        card.style.top = '0';
        card.style.transform = 'none';
        activeMaximizedCard = card;
        bringToFront(card);
      }
      updateBodyMaximizedState();
    }

    // --- æ‹–æ‹½é€»è¾‘ (ä¼˜åŒ–ç‰ˆ) ---
    function startDrag(event, card) {
      const state = cardStates.get(card);
      if (!state || card.classList.contains('maximized')) return;
      
      card.classList.add('dragging');
      bringToFront(card);
      
      // è®°å½•åˆå§‹ç‚¹å’Œä½ç½®
      const startX = event.clientX;
      const startY = event.clientY;
      const originalX = state.x; // vw
      const originalY = state.y; // vh
      
      // è½¬æ¢ä¸ºåƒç´ ä»¥ä¾¿è®¡ç®—ï¼Œé¿å…å¤šæ¬¡å•ä½è½¬æ¢è¯¯å·®
      const vwToPx = window.innerWidth / 100;
      const vhToPx = window.innerHeight / 100;
      
      // æ•è·æŒ‡é’ˆäº‹ä»¶ï¼Œè¿™å¯¹ç§»åŠ¨ç«¯æ‹–å‡ºå±å¹•è¾¹ç¼˜å¾ˆé‡è¦
      card.setPointerCapture(event.pointerId);

      function handlePointerMove(e) {
        e.preventDefault(); // å†æ¬¡ç¡®ä¿ä¸æ»šåŠ¨
        
        // è®¡ç®—åƒç´ ä½ç§»
        const pixelDeltaX = e.clientX - startX;
        const pixelDeltaY = e.clientY - startY;
        
        // è½¬æ¢ä¸ºè§†å›¾å•ä½ (1:1 è·Ÿéš)
        // ç§»é™¤åŸæœ‰çš„ /0.5 é€»è¾‘ï¼Œå®ç°çœŸæ­£çš„æŒ‡å°–è·Ÿéš
        const deltaVW = pixelDeltaX / vwToPx;
        const deltaVH = pixelDeltaY / vhToPx;
        
        // é™åˆ¶åœ¨å±å¹•å†…ï¼Œç•™å‡ºä¸€å®šè¾¹è·
        const newX = clamp(originalX + deltaVW, -10, 100); 
        const newY = clamp(originalY + deltaVH, -10, 100);
        
        card.style.left = newX + 'vw';
        card.style.top = newY + 'vh';
        
        state.x = newX;
        state.y = newY;
      }
      
      function handlePointerUp(e) {
        card.classList.remove('dragging');
        card.releasePointerCapture(e.pointerId);
        
        card.removeEventListener('pointermove', handlePointerMove);
        card.removeEventListener('pointerup', handlePointerUp);
        card.removeEventListener('pointercancel', handlePointerUp);
      }
      
      // ç›´æ¥ç»‘å®šåˆ°å¡ç‰‡æœ¬èº«ï¼Œé…åˆ setPointerCapture ä½¿ç”¨
      card.addEventListener('pointermove', handlePointerMove);
      card.addEventListener('pointerup', handlePointerUp);
      card.addEventListener('pointercancel', handlePointerUp);
    }

    function createCard() {
      if (board.children.length >= maxCards) return;

      const card = document.createElement('div');
      card.className = 'card';
      
      const color = randomFrom(colors);
      card.style.backgroundColor = color;
      
      // ç¡®ä¿åˆå§‹ä½ç½®åœ¨å¯è§åŒºåŸŸå†…
      const cardWidthVW = (isMobile ? 180 : 220) / window.innerWidth * 100;
      const cardHeightVH = 200 / window.innerHeight * 100; // ä¼°ç®—é«˜åº¦
      
      const left = Math.random() * (100 - cardWidthVW - 5) + 'vw';
      const top = Math.random() * (100 - cardHeightVH - 5) + 'vh';
      
      card.style.left = left;
      card.style.top = top;
      
      const angle = (Math.random() - 0.5) * 10;
      card.style.transform = `rotate(${angle}deg)`;
      
      const message = randomFrom(messages);
      
      card.innerHTML = `
        <div class="card-header">
          <div class="card-title">ä¾¿ç­¾</div>
          <div class="window-controls">
            <button class="control close" aria-label="å…³é—­"></button>
            <button class="control minimize" aria-label="æœ€å°åŒ–"></button>
            <button class="control maximize" aria-label="æœ€å¤§åŒ–"></button>
          </div>
        </div>
        <div class="card-body">${message}</div>
      `;
      
      cardStates.set(card, {
        angle,
        scale: 1,
        x: parseFloat(left),
        y: parseFloat(top)
      });
      
      board.appendChild(card);
      
      setTimeout(() => { card.style.opacity = '1'; }, 50);
      bringToFront(card);
    }

    // --- åˆå§‹åŒ–ä¸åº”ç”¨é€»è¾‘ ---
    window.addEventListener('DOMContentLoaded', () => {
      const startBackdrop = document.getElementById('start-backdrop');
      startBackdrop.classList.add('active');
      
      const confirmBtn = document.getElementById('confirm-btn');
      
      confirmBtn.addEventListener('click', () => {
        startBackdrop.classList.remove('active');
        document.querySelector('.controls').style.display = 'flex';
        document.getElementById('page-footer').style.display = 'block';
        
        const bgMusic = document.getElementById('bgMusic');
        bgMusic.volume = 0.3;
        
        // ç§»åŠ¨ç«¯éŸ³é¢‘æ’­æ”¾å…¼å®¹å¤„ç†
        try {
          bgMusic.play().catch(e => {
              console.log('è‡ªåŠ¨æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’', e);
              // å¯ä»¥é€‰æ‹©æ·»åŠ ä¸€ä¸ªç‚¹å‡»é¡µé¢çš„ä¸€æ¬¡æ€§ç›‘å¬å™¨æ¥é‡è¯•æ’­æ”¾
              document.body.addEventListener('click', function playOnce() {
                  bgMusic.play();
                  document.body.removeEventListener('click', playOnce);
              }, { once: true });
          });
        } catch (err) {
          console.error("Music play error:", err);
        }

        // åˆå§‹ç”Ÿæˆ
        for (let i = 0; i < initialCardCount; i++) {
          setTimeout(createCard, i * 100);
        }
        scheduleNextSpawn();
      });

      // çª—å£è°ƒæ•´ä¸ä¸»é¢˜
      window.addEventListener('resize', syncMobileMode);
      
      const themeBtn = document.getElementById('themeBtn');
      const replayBtn = document.getElementById('replay-main');
      let darkMode = false;

      themeBtn.addEventListener('click', () => {
        window.location.href = 'https://sctre.github.io/second/';
      });

      replayBtn.addEventListener('click', () => {
        darkMode = !darkMode;
        document.body.classList.toggle('dark', darkMode);
        
        if (darkMode) startSnow(); else stopSnow();
        
        const cards = board.querySelectorAll('.card');
        cards.forEach(card => {
          const state = cardStates.get(card);
          if (state) state.closing = true;
          card.style.opacity = '0';
          setTimeout(() => card.remove(), 350);
        });
        
        setTimeout(() => {
          for (let i = 0; i < initialCardCount; i++) {
            setTimeout(createCard, i * 100);
          }
          const bgMusic = document.getElementById('bgMusic');
          bgMusic.currentTime = 0;
          bgMusic.play().catch(e => console.error(e));
        }, 400);
      });
    });
  </script>
</body>
</html>